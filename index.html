<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯ ÙØ±Ø­ â¤ï¸</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;}
canvas{display:block;}
#ui{
  position:absolute;top:16px;left:50%;transform:translateX(-50%);
  background:rgba(255,255,255,0.2);backdrop-filter:blur(10px);
  padding:10px 20px;border-radius:30px;color:white;font-size:22px;font-weight:800;
  display:flex;align-items:center;gap:8px;box-shadow:0 8px 20px rgba(0,0,0,.25);pointer-events:none;
}
.overlay{
  position:absolute;inset:0;background:rgba(255,182,193,.95);
  display:flex;flex-direction:column;align-items:center;justify-content:center;color:white;text-align:center;
}
button{
  padding:14px 28px;border:none;border-radius:30px;font-size:18px;background:white;color:#ff2f92;margin-top:20px;
}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="ui">â¤ï¸ <span id="score">0</span></div>

<div id="start" class="overlay">
  <h1>ğŸ‚ Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯ ÙØ±Ø­ â¤ï¸</h1>
  <p>Ø§Ø³Ø­Ø¨ÙŠ Ù„ØªÙ„Ø¹Ø¨ÙŠ</p>
  <button onclick="startGame()">Ø§Ø¨Ø¯Ø¦ÙŠ Ø§Ù„Ù„Ø¹Ø¨</button>
</div>

<div id="messageBox" class="overlay" style="display:none">
  <h2 id="msgText"></h2>
  <button onclick="resumeGame()">Ø§Ø³ØªÙ…Ø±ÙŠ</button>
</div>

<div id="end" class="overlay" style="display:none">
  <h1>ğŸ‰ Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯ ÙØ±Ø­ ğŸ‰</h1>
  <p>100 Ù†Ù‚Ø·Ø©ØŒ ÙƒÙ„Ù‡Ø§ Ù„ÙƒÙ â¤ï¸</p>
  <button onclick="location.reload()">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
</div>

<audio id="bgm" src="music.mp3" loop preload="auto" playsinline></audio>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
resize();addEventListener("resize",resize);

const bgImg=new Image();
let bgReady=false;
bgImg.onload=()=>bgReady=true;
bgImg.onerror=()=>{console.error("bg.png failed to load"); bgReady=false;};
bgImg.src="bg.jpg";

let playing=false,paused=false,score=0,shake=0;
const lanes=[-0.28,0,0.28];
let lanePos=1,targetLane=1;
const player={y:0,vy:0,baseSize:60,sliding:false,slideTimer:0,wave:0};
const gravity=0.9,speed=7;
const items=[],particles=[],confetti=[];
const bgm=document.getElementById("bgm");
bgm.volume=0.3;

const messages=[
  {score:10,text:"ÙÙŠ ÙŠÙˆÙ… Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ø£ÙˆØ¯Ù‘ Ø£Ù† Ø£Ø®Ø¨Ø±Ùƒ Ø£Ù† ÙˆØ¬ÙˆØ¯Ùƒ ÙÙŠ Ø­ÙŠØ§ØªÙŠ Ù†Ø¹Ù…Ø© Ø£Ø­Ù…Ø¯ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡Ø§ ÙƒÙ„ ÙŠÙˆÙ…ØŒ ÙˆÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ Ø£Ù‚Ø±Ø¨ Ù„Ù‚Ù„Ø¨ÙŠ Ù…Ù† Ø£ÙŠ Ø´ÙŠØ¡.",shown:false},
  {score:20,text:"Ø£Ù†ØªÙ ØªØ¬Ø¹Ù„ÙŠÙ† ÙƒÙ„ Ø´ÙŠØ¡ Ø£Ø¬Ù…Ù„ ğŸŒ¸",shown:false},
  {score:30,text:"Ù„Ø«Ø§Ù…Ù† Ø¹Ø´Ø± Ù…Ù† Ø¯ÙŠØ³Ù…Ø¨Ø± Ù„ÙŠØ³ Ù…Ø¬Ø±Ø¯ ØªØ§Ø±ÙŠØ®ØŒ Ø¨Ù„ ÙŠÙˆÙ… Ø§Ø®ØªØ§Ø±Øª ÙÙŠÙ‡ Ø§Ù„Ø­ÙŠØ§Ø© Ø£Ù† ØªÙƒÙˆÙ† Ø£Ø¬Ù…Ù„ Ø­ÙŠÙ† ÙˆÙÙ„Ø¯ØªÙ Ø£Ù†ØªÙ.ğŸŒ¸",shown:false},
  {score:40,text:"ÙƒØ¨Ø±ØªÙ Ø¹Ø§Ù…Ù‹Ø§ ÙŠØ§ ÙØ±Ø­ØŒ Ù„ÙƒÙ† ÙÙŠ Ø±ÙˆØ­Ùƒ ØµÙØ§Ø¡ Ù„Ø§ ÙŠÙƒØ¨Ø±ØŒ ÙˆØ¯ÙØ¡ Ù„Ø§ ÙŠØªØºÙŠÙ‘Ø±ØŒ ÙˆÙ†ÙˆØ± ÙŠØ²Ø¯Ø§Ø¯ Ø¨Ù‡Ø§Ø¡Ù‹ Ù…Ø¹ Ø§Ù„Ø£ÙŠØ§Ù….ğŸŒ¸",shown:false},
  {score:50,text:"Ù„Ù… Ø£Ø­Ø¨Ùƒ Ù„Ø£Ù†Ùƒ Ù…Ø«Ø§Ù„ÙŠØ©ØŒ Ø¨Ù„ Ø£Ø­Ø¨Ø¨ØªÙƒ Ù„Ø£Ù†Ùƒ ØµØ§Ø¯Ù‚Ø©ØŒ Ù„Ø£Ù†Ùƒ ÙƒÙ…Ø§ Ø£Ù†ØªÙØŒ ÙˆÙ„Ø£Ù† ÙÙŠ Ø­Ø¶ÙˆØ±Ùƒ Ø³Ù„Ø§Ù…Ù‹Ø§ ÙŠØ·Ù…Ø¦Ù† Ø§Ù„Ù‚Ù„Ø¨.ğŸŒ¸",shown:false},
  {score:60,text:"Ø£Ù†Ø§ Ù…Ø­Ø¸ÙˆØ¸ Ø¬Ø¯Ù‹Ø§ Ø¨ÙƒÙ ğŸ’•",shown:false},
  {score:70,text:"ÙÙŠ Ø¹ÙŠÙ†ÙŠÙƒ Ø·Ù…Ø£Ù†ÙŠÙ†Ø©ØŒ ÙˆÙÙŠ ØµÙˆØªÙƒ Ø£Ù…Ø§Ù†ØŒ ÙˆÙ…Ø¹Ùƒ Ø£Ø´Ø¹Ø± Ø£Ù† Ø§Ù„Ø¹Ø§Ù„Ù… Ù…Ù‡Ù…Ø§ Ø§Ø´ØªØ¯Ù‘ØŒ ÙŠØµØ¨Ø­ Ø£Ù„ÙŠÙ†.",shown:false},
  {score:80,text:"ÙØ±Ø­ØŒ Ù„Ø³ØªÙ Ù…Ø¬Ø±Ø¯ Ø°ÙƒØ±Ù‰ Ø¬Ù…ÙŠÙ„Ø© ÙÙŠ Ø­ÙŠØ§ØªÙŠØŒ Ø¨Ù„ Ø­Ù„Ù… Ø£ØªÙ…Ø³Ùƒ Ø¨Ù‡ØŒ ÙˆÙ…Ø³ØªÙ‚Ø¨Ù„ Ø£Ø±Ø¬Ùˆ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„ÙƒÙ ÙÙŠÙ‡ Ù…ÙƒØ§Ù† Ø§Ù„Ù‚Ù„Ø¨ ÙˆØ§Ù„Ø¨ÙŠØª Ù…Ø¹Ù‹Ø§.",shown:false},
  {score:90,text:"ÙˆØ£Ù†ØªÙ Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø¹Ø§Ù…Ùƒ Ø§Ù„Ø­Ø§Ø¯ÙŠ ÙˆØ§Ù„Ø¹Ø´Ø±ÙŠÙ†ØŒ Ø£ØªÙ…Ù†Ù‰ Ø£Ù† Ø£ÙƒÙˆÙ† Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ÙŠØ´Ø§Ø±ÙƒÙƒ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©ØŒ ÙØ±Ø­Ù‡Ø§ ÙˆØªØ¹Ø¨Ù‡Ø§ØŒ Ù†Ø¬Ø§Ø­Ù‡Ø§ ÙˆØªÙØ§ØµÙŠÙ„Ù‡Ø§ Ø§Ù„ØµØºÙŠØ±Ø©.",shown:false}
];

function showMessage(text){
  document.getElementById("msgText").textContent=text;
  messageBox.style.display="flex";
  paused=true;
  bgm.pause();
}

function checkMessages(){
  messages.forEach(msg=>{
    if(!msg.shown && score >= msg.score){
      msg.shown=true;
      showMessage(msg.text);
      spawnConfetti(30);
    }
  });
}

function spawnItem(){
  const r=Math.random();
  let type="heart";
  if(r>0.7)type="flower";
  if(r>0.85)type="ring";
  if(r>0.95)type="bomb";
  items.push({lane:Math.floor(Math.random()*3),y:-40,type});
}
setInterval(()=>{if(playing&&!paused)spawnItem()},900);

function drawKitty(x,y){
  ctx.save();
  ctx.translate(x,y);
  ctx.scale(1,player.sliding?0.6:1);

  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(0,0,player.baseSize/2,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="black";
  ctx.beginPath();
  ctx.arc(-10,-5,4,0,Math.PI*2);
  ctx.arc(10,-5,4,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="gold";
  ctx.beginPath();
  ctx.arc(0,3,4,0,Math.PI*2);
  ctx.fill();

  ctx.strokeStyle="black";
  [-1,1].forEach(d=>{
    ctx.beginPath();
    ctx.moveTo(d*8,6);ctx.lineTo(d*20,2);
    ctx.moveTo(d*8,10);ctx.lineTo(d*20,10);
    ctx.stroke();
  });

  ctx.fillStyle="#ff2f92";
  ctx.beginPath();
  ctx.arc(14,-18,8,0,Math.PI*2);
  ctx.arc(24,-18,8,0,Math.PI*2);
  ctx.fill();

  if(player.wave>0){
    ctx.strokeStyle="white";
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.arc(22,10,10,Math.PI*1.2,Math.PI*1.8);
    ctx.stroke();
    player.wave--;
  }
  ctx.restore();
}

function bombExplosion(x,y){
  shake=15;
  for(let i=0;i<30;i++){
    particles.push({x,y,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8,life:30,color:"orange"});
  }
}

function spawnPickupParticles(x,y,color="gold"){
  for(let i=0;i<15;i++){
    particles.push({x,y,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,life:25+Math.random()*10,color});
  }
}

function spawnConfetti(count){
  for(let i=0;i<count;i++){
    confetti.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,vy:2+Math.random()*2,c:`hsl(${Math.random()*360},100%,70%)`});
  }
}

function loop(){
  if(!playing)return;
  requestAnimationFrame(loop);
  if(paused)return;

  if(shake>0)shake--;
  ctx.save();
  ctx.translate(shake?Math.random()*6-3:0,shake?Math.random()*6-3:0);

  // Background
if (bgReady) {
  const imgRatio = bgImg.width / bgImg.height;
  const scrRatio = canvas.width / canvas.height;
  let w, h;

  if (imgRatio > scrRatio) {
    h = canvas.height;
    w = h * imgRatio;
  } else {
    w = canvas.width;
    h = w / imgRatio;
  }

  ctx.drawImage(
    bgImg,
    (canvas.width - w) / 2,
    (canvas.height - h) / 2,
    w,
    h
  );
}else{
    ctx.fillStyle="#aee7ff";
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  lanePos+=(targetLane-lanePos)*0.12;
  const px=canvas.width/2+lanes[Math.round(lanePos)]*canvas.width;

  player.vy+=gravity;
  player.y+=player.vy;
  if(player.y>canvas.height-150){player.y=canvas.height-150;player.vy=0;}

  if(player.sliding){player.slideTimer--; if(player.slideTimer<=0)player.sliding=false;}

  drawKitty(px,player.y);

  const hitY=player.sliding?30:50;
  items.forEach((it,i)=>{
    it.y+=speed;
    const ix=canvas.width/2+lanes[it.lane]*canvas.width;
    ctx.font="32px serif";
    ctx.fillText({heart:"â¤ï¸",flower:"ğŸŒ¸",ring:"ğŸ’",bomb:"ğŸ’£"}[it.type],ix-16,it.y);

    if(it.lane===Math.round(lanePos)&&it.y>player.y-hitY&&it.y<player.y+40){
      items.splice(i,1);
      let delta={heart:1,flower:2,ring:3,bomb:-3}[it.type];
      score=Math.max(0,score+delta);
      document.getElementById("score").textContent=score;

      if(delta>0){
        player.wave=20;
        if(it.type==="flower") spawnPickupParticles(ix,it.y,"pink");
        if(it.type==="ring") spawnPickupParticles(ix,it.y,"deepskyblue");
      }else bombExplosion(ix,it.y);

      checkMessages();

      navigator.vibrate?.(delta>0?30:120);
      if(score>=100)endGame();
    }
  });

  // Particles
  particles.forEach((p,i)=>{
    p.x+=p.vx;p.y+=p.vy;p.life--;
    ctx.fillStyle=p.color||"orange";
    ctx.fillRect(p.x,p.y,4,4);
    if(p.life<=0)particles.splice(i,1);
  });

  ctx.restore();
}

function confettiLoop(){
  if(end.style.display==="flex"){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetti.forEach(c=>{
      c.y+=c.vy;
      ctx.fillStyle=c.c;
      ctx.fillRect(c.x,c.y,6,6);
      if(c.y>canvas.height)c.y=-10;
    });
    requestAnimationFrame(confettiLoop);
  }
}

function startGame(){
  start.style.display="none";
  player.y=canvas.height-150;
  playing=true;
  bgm.play().catch(()=>{});
  loop();
}

function resumeGame(){
  paused=false;
  bgm.play().catch(()=>{});
  messageBox.style.display="none";
}

function endGame(){
  playing=false;
  bgm.pause();
  end.style.display="flex";
  spawnConfetti(100);
  confettiLoop();
}

// Touch controls
let sx=0,sy=0;
addEventListener("touchstart",e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY;});
addEventListener("touchend",e=>{
  const dx=e.changedTouches[0].clientX-sx;
  const dy=e.changedTouches[0].clientY-sy;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>40&&targetLane<2)targetLane++;
    if(dx<-40&&targetLane>0)targetLane--;
  }else{
    if(dy<-40&&player.vy===0)player.vy=-18;
    if(dy>40&&!player.sliding){player.sliding=true;player.slideTimer=25;}
  }
});
</script>
</body>
</html>
