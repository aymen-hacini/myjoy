<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Happy Birthday ‚ù§Ô∏è</title>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  touch-action:none;
  background:black;
  font-family:system-ui,sans-serif;
}
canvas{display:block}

#ui{
  position:absolute;
  top:10px;
  width:100%;
  text-align:center;
  color:white;
  font-size:18px;
  text-shadow:0 2px 5px rgba(0,0,0,.5);
  pointer-events:none;
}

.overlay{
  position:absolute;
  inset:0;
  background:rgba(255,182,193,.95);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  color:white;
  text-align:center;
}

button{
  padding:14px 28px;
  border:none;
  border-radius:30px;
  font-size:18px;
  background:white;
  color:#ff2f92;
  margin-top:20px;
}
</style>
</head>

<body>

<canvas id="game"></canvas>
<div id="ui">Score ‚ù§Ô∏è <span id="score">0</span></div>

<div id="start" class="overlay">
  <h1>üéÇ Happy Birthday ‚ù§Ô∏è</h1>
  <p>Swipe to play</p>
  <button onclick="startGame()">Start</button>
</div>

<div id="messageBox" class="overlay" style="display:none">
  <h2 id="msgText"></h2>
  <button onclick="resumeGame()">Resume</button>
</div>

<div id="end" class="overlay" style="display:none">
  <h1>üéâ Happy Birthday Aisha üéâ</h1>
  <p>100 points, all for you ‚ù§Ô∏è</p>
  <button onclick="location.reload()">Play Again</button>
</div>

<audio id="bgm" src="music.mp3" loop preload="auto" playsinline></audio>

<script>
/* ================= SETUP ================= */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();addEventListener("resize",resize);

/* ================= BACKGROUND IMAGE ================= */
const bgImg=new Image();
bgImg.src="bg.jpg";

/* ================= STATE ================= */
let playing=false,paused=false,score=0;
const lanes=[-0.28,0,0.28];
let lanePos=1,targetLane=1;

const player={
  y:0,vy:0,
  baseSize:60,
  sliding:false,
  slideTimer:0,
  blink:0,blinkTimer:0,
  wave:0
};

const gravity=0.9,speed=7;
const items=[];
const messages={
  20:"You make everything brighter üå∏",
  50:"So lucky to have you üíï",
  80:"Almost there üéÇ"
};

/* ================= AUDIO ================= */
const bgm=document.getElementById("bgm");
bgm.volume=0.3;

/* ================= SPAWN LOGIC ================= */
function spawnItem(){
  const r=Math.random();
  let type="heart";
  if(r>0.7) type="flower";
  if(r>0.85) type="ring";
  if(r>0.95) type="bomb";
  items.push({lane:Math.floor(Math.random()*3),y:-40,type});
}
setInterval(()=>{if(playing&&!paused)spawnItem()},900);

/* ================= DRAW KITTY ================= */
function drawKitty(x,y){
  player.blinkTimer++;
  if(player.blinkTimer>180){player.blink=10;player.blinkTimer=0}
  if(player.blink>0)player.blink--;

  ctx.save();
  ctx.translate(x,y);

  // Slide squash
  const scaleY=player.sliding?0.6:1;
  ctx.scale(1,scaleY);

  // Head
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(0,0,player.baseSize/2,0,Math.PI*2);
  ctx.fill();

  // Eyes
  ctx.fillStyle="black";
  ctx.beginPath();
  if(player.blink===0){
    ctx.arc(-10,-5,4,0,Math.PI*2);
    ctx.arc(10,-5,4,0,Math.PI*2);
  }else{
    ctx.rect(-14,-5,8,2);
    ctx.rect(6,-5,8,2);
  }
  ctx.fill();

  // Nose
  ctx.fillStyle="gold";
  ctx.beginPath();
  ctx.arc(0,3,4,0,Math.PI*2);
  ctx.fill();

  // Whiskers
  ctx.strokeStyle="black";
  [-1,1].forEach(d=>{
    ctx.beginPath();
    ctx.moveTo(d*8,6);ctx.lineTo(d*20,2);
    ctx.moveTo(d*8,10);ctx.lineTo(d*20,10);
    ctx.stroke();
  });

  // Bow
  ctx.fillStyle="#ff2f92";
  ctx.beginPath();
  ctx.arc(14,-18,8,0,Math.PI*2);
  ctx.arc(24,-18,8,0,Math.PI*2);
  ctx.fill();

  // Wave paw
  if(player.wave>0){
    ctx.strokeStyle="white";
    ctx.lineWidth=5;
    ctx.beginPath();
    ctx.arc(22,10,10,Math.PI*1.2,Math.PI*1.8);
    ctx.stroke();
    player.wave--;
  }

  ctx.restore();
}

/* ================= GAME LOOP ================= */
function loop(){
  if(!playing)return;
  requestAnimationFrame(loop);
  if(paused)return;

  ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);

  ctx.fillStyle="#fff";
  ctx.fillRect(0,canvas.height-90,canvas.width,90);

  lanePos+=(targetLane-lanePos)*0.12;
  const px=canvas.width/2+lanes[Math.round(lanePos)]*canvas.width;

  player.vy+=gravity;
  player.y+=player.vy;
  if(player.y>canvas.height-150){
    player.y=canvas.height-150;
    player.vy=0;
  }

  if(player.sliding){
    player.slideTimer--;
    if(player.slideTimer<=0)player.sliding=false;
  }

  drawKitty(px,player.y);

  items.forEach((it,i)=>{
    it.y+=speed;
    const ix=canvas.width/2+lanes[it.lane]*canvas.width;

    ctx.font="32px serif";
    const icon={
      heart:"‚ù§Ô∏è",
      flower:"üå∏",
      ring:"üíé",
      bomb:"üí£"
    }[it.type];
    ctx.fillText(icon,ix-16,it.y);

    const hitY=player.sliding?30:50;
    if(it.lane===Math.round(lanePos)&&it.y>player.y-hitY&&it.y<player.y+40){
      items.splice(i,1);
      let delta=0;
      if(it.type==="heart")delta=1;
      if(it.type==="flower")delta=2;
      if(it.type==="ring")delta=3;
      if(it.type==="bomb")delta=-3;

      score=Math.max(0,score+delta);
      scoreEl.textContent=score;

      if(delta>0)player.wave=20;
      navigator.vibrate?.(delta>0?30:80);

      if(messages[score])showMessage(messages[score]);
      if(score>=100)endGame();
    }
  });
}

/* ================= POPUPS ================= */
function showMessage(t){
  paused=true;
  bgm.pause();
  msgText.textContent=t;
  messageBox.style.display="flex";
}
function resumeGame(){
  paused=false;
  bgm.play().catch(()=>{});
  messageBox.style.display="none";
}
function endGame(){
  playing=false;
  bgm.pause();
  end.style.display="flex";
}

/* ================= START ================= */
function startGame(){
  start.style.display="none";
  player.y=canvas.height-150;
  playing=true;
  bgm.play().catch(()=>{});
  loop();
}

/* ================= TOUCH ================= */
let sx=0,sy=0;
addEventListener("touchstart",e=>{
  sx=e.touches[0].clientX;
  sy=e.touches[0].clientY;
});
addEventListener("touchend",e=>{
  const dx=e.changedTouches[0].clientX-sx;
  const dy=e.changedTouches[0].clientY-sy;

  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>40&&targetLane<2)targetLane++;
    if(dx<-40&&targetLane>0)targetLane--;
  }else{
    if(dy<-40&&player.vy===0){
      player.vy=-18;
    }
    if(dy>40&&!player.sliding){
      player.sliding=true;
      player.slideTimer=25;
    }
  }
});

const scoreEl=document.getElementById("score");
</script>

</body>
</html>
