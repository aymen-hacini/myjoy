<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Happy Birthday ‚ù§Ô∏è</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #cceeff;
  touch-action: none;
  font-family: system-ui, sans-serif;
}
canvas { display:block; }

#ui {
  position:absolute;
  top:10px;
  width:100%;
  text-align:center;
  color:white;
  font-size:18px;
  text-shadow:0 2px 5px rgba(0,0,0,.4);
  pointer-events:none;
}

.overlay {
  position:absolute;
  inset:0;
  background:rgba(255,182,193,.95);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  color:white;
}

button {
  padding:14px 28px;
  border:none;
  border-radius:30px;
  font-size:18px;
  background:white;
  color:#ff2f92;
  margin-top:20px;
}
</style>
</head>

<body>

<canvas id="game"></canvas>
<div id="ui">‚ù§Ô∏è Hearts: <span id="score">0</span></div>

<div id="start" class="overlay">
  <h1>üéÇ Happy Birthday ‚ù§Ô∏è</h1>
  <p>Swipe to play</p>
  <button onclick="startGame()">Start</button>
</div>

<div id="messageBox" class="overlay" style="display:none">
  <h2 id="msgText"></h2>
  <button onclick="resumeGame()">Resume</button>
</div>

<div id="end" class="overlay" style="display:none">
  <h1>üéâ Happy Birthday Aisha üéâ</h1>
  <p>100 hearts, all for you ‚ù§Ô∏è</p>
  <button onclick="location.reload()">Play Again</button>
</div>

<!-- REAL MUSIC -->
<audio id="bgm" src="music.mp3" loop preload="auto" playsinline></audio>

<script>
/* ================= SETUP ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){ canvas.width=innerWidth; canvas.height=innerHeight; }
resize(); addEventListener("resize",resize);

/* ================= STATE ================= */
let playing=false, paused=false, score=0;
const lanes=[-0.28,0,0.28];
let lanePos=1, targetLane=1;

const player={
  y:0, vy:0, baseSize:60,
  blink:0, blinkTimer:0,
  squash:1
};

const gravity=0.9, speed=7;
const hearts=[], confetti=[];
const flowers=[];
let bgOffset=0;

/* ================= MESSAGES ================= */
const messages={
  10:"You make everything beautiful üå∏",
  30:"I‚Äôm so grateful for you üíï",
  60:"You deserve all the love ‚ù§Ô∏è",
  90:"Almost there üéÇ"
};

/* ================= FLOWERS ================= */
for(let i=0;i<25;i++){
  flowers.push({
    x:Math.random()*canvas.width,
    sway:Math.random()*Math.PI*2,
    size:6+Math.random()*6,
    color:`hsl(${Math.random()*360},80%,70%)`
  });
}

/* ================= AUDIO FIX ================= */
const bgm=document.getElementById("bgm");
bgm.volume=0.3;

/* ================= DRAW BACKGROUND ================= */
function drawGarden(){
  ctx.fillStyle="#aee7ff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#7ed957";
  ctx.beginPath();
  ctx.arc(canvas.width*0.2,canvas.height,400,Math.PI,0);
  ctx.arc(canvas.width*0.7,canvas.height,500,Math.PI,0);
  ctx.fill();

  flowers.forEach((f,i)=>{
    f.sway+=0.02;
    const sway=Math.sin(f.sway)*5;
    const y=canvas.height-90;
    ctx.save();
    ctx.translate((f.x+bgOffset)%canvas.width,y);
    ctx.rotate(Math.sin(f.sway)*0.2);
    ctx.fillStyle=f.color;
    for(let p=0;p<5;p++){
      ctx.rotate(Math.PI*2/5);
      ctx.beginPath();
      ctx.arc(0,f.size, f.size,0,Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  });
}

/* ================= KITTY ================= */
function drawKitty(x,y){
  player.blinkTimer++;
  if(player.blinkTimer>200){
    player.blink=10;
    player.blinkTimer=0;
  }
  if(player.blink>0) player.blink--;

  ctx.save();
  ctx.translate(x,y);
  ctx.scale(1,player.squash);

  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(0,0,player.baseSize/2,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="black";
  ctx.beginPath();
  if(player.blink===0){
    ctx.arc(-10,-5,4,0,Math.PI*2);
    ctx.arc(10,-5,4,0,Math.PI*2);
  } else {
    ctx.rect(-14,-5,8,2);
    ctx.rect(6,-5,8,2);
  }
  ctx.fill();

  ctx.fillStyle="gold";
  ctx.beginPath();
  ctx.arc(0,3,4,0,Math.PI*2);
  ctx.fill();

  ctx.strokeStyle="black";
  [-1,1].forEach(d=>{
    ctx.beginPath();
    ctx.moveTo(d*8,6); ctx.lineTo(d*20,2);
    ctx.moveTo(d*8,10); ctx.lineTo(d*20,10);
    ctx.stroke();
  });

  ctx.fillStyle="#ff2f92";
  ctx.beginPath();
  ctx.arc(14,-18,8,0,Math.PI*2);
  ctx.arc(24,-18,8,0,Math.PI*2);
  ctx.fill();

  ctx.restore();
}

/* ================= GAME LOOP ================= */
function spawnHeart(){
  hearts.push({lane:Math.floor(Math.random()*3),y:-30});
}
setInterval(()=>{ if(playing&&!paused)spawnHeart(); },900);

function loop(){
  if(!playing) return;
  requestAnimationFrame(loop);
  if(paused) return;

  bgOffset+=1;
  drawGarden();

  ctx.fillStyle="#fff";
  ctx.fillRect(0,canvas.height-90,canvas.width,90);

  lanePos+=(targetLane-lanePos)*0.12;
  const px=canvas.width/2+lanes[Math.round(lanePos)]*canvas.width;

  player.vy+=gravity;
  player.y+=player.vy;
  if(player.y>canvas.height-150){
    player.y=canvas.height-150;
    player.vy=0;
    player.squash+= (1-player.squash)*0.2;
  } else {
    player.squash=0.9;
  }

  drawKitty(px,player.y);

  hearts.forEach((h,i)=>{
    h.y+=speed;
    const hx=canvas.width/2+lanes[h.lane]*canvas.width;
    ctx.font="32px serif";
    ctx.fillText("‚ù§Ô∏è",hx-16,h.y);

    if(h.lane===Math.round(lanePos)&&h.y>player.y-20&&h.y<player.y+40){
      hearts.splice(i,1);
      score++;
      scoreEl.textContent=score;
      if(messages[score]) showMessage(messages[score]);
      if(score>=100) endGame();
      navigator.vibrate?.(30);
    }
  });
}

/* ================= POPUPS ================= */
function showMessage(t){
  paused=true;
  bgm.pause();
  msgText.textContent=t;
  messageBox.style.display="flex";
}

function resumeGame(){
  paused=false;
  bgm.play().catch(()=>{});
  messageBox.style.display="none";
}

function endGame(){
  playing=false;
  bgm.pause();
  end.style.display="flex";
}

/* ================= START ================= */
function startGame(){
  start.style.display="none";
  player.y=canvas.height-150;
  playing=true;
  bgm.play().catch(()=>{});
  loop();
}

/* ================= TOUCH ================= */
let sx=0,sy=0;
addEventListener("touchstart",e=>{
  sx=e.touches[0].clientX;
  sy=e.touches[0].clientY;
});
addEventListener("touchend",e=>{
  const dx=e.changedTouches[0].clientX-sx;
  const dy=e.changedTouches[0].clientY-sy;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>40&&targetLane<2)targetLane++;
    if(dx<-40&&targetLane>0)targetLane--;
  } else if(dy<-40&&player.vy===0){
    player.vy=-18;
    player.squash=1.1;
  }
});

const scoreEl=document.getElementById("score");
</script>

</body>
</html>
