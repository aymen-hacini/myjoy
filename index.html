<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Happy Birthday ‚ù§Ô∏è</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #ffd6e7;
  touch-action: none;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

canvas {
  display: block;
}

#ui {
  position: absolute;
  top: 12px;
  width: 100%;
  text-align: center;
  font-size: 18px;
  color: white;
  text-shadow: 0 2px 6px rgba(0,0,0,.4);
  pointer-events: none;
}

.overlay {
  position: absolute;
  inset: 0;
  background: rgba(255,105,180,0.95);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  color: white;
}

button {
  padding: 14px 28px;
  border-radius: 30px;
  border: none;
  font-size: 18px;
  margin-top: 20px;
  background: white;
  color: #ff2f92;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<div id="ui">‚ù§Ô∏è Hearts: <span id="score">0</span></div>

<div id="start" class="overlay">
  <h1>üéÇ Happy Birthday ‚ù§Ô∏è</h1>
  <p>Swipe to play</p>
  <button onclick="startGame()">Start</button>
</div>

<div id="messageBox" class="overlay" style="display:none">
  <h2 id="msgText"></h2>
  <button onclick="resumeGame()">Resume</button>
</div>

<script>
/* ================= CANVAS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* ================= GAME STATE ================= */
let playing = false;
let paused = false;
let score = 0;

const lanes = [-0.25, 0, 0.25];
let currentLane = 1;

const player = {
  y: 0,
  vy: 0,
  size: 60,
  jumping: false,
  sliding: false
};

const gravity = 0.9;
const speed = 7;

const hearts = [];
const confetti = [];

/* ================= MESSAGES ================= */
const messages = {
  5: "You make my days happier ‚ù§Ô∏è",
  15: "I smile because of you üíï",
  30: "Today is your day üéÇ",
  50: "Happy Birthday ‚ù§Ô∏è"
};

/* ================= AUDIO ================= */
let audioCtx;
let musicGain;

function initAudio() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  musicGain = audioCtx.createGain();
  musicGain.gain.value = 0.05;
  musicGain.connect(audioCtx.destination);

  const osc = audioCtx.createOscillator();
  osc.type = "sine";
  osc.frequency.value = 220;
  osc.connect(musicGain);
  osc.start();
}

function popupSound() {
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 880;
  g.gain.value = 0.2;
  o.connect(g).connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + 0.15);
}

/* ================= CONFETTI ================= */
function spawnConfetti() {
  for (let i = 0; i < 60; i++) {
    confetti.push({
      x: Math.random() * canvas.width,
      y: -20,
      vx: (Math.random() - 0.5) * 6,
      vy: Math.random() * 6 + 2,
      color: `hsl(${Math.random()*360},100%,70%)`
    });
  }
}

/* ================= PLAYER DRAW ================= */
function drawHelloKitty(x, y, size) {
  ctx.save();
  ctx.translate(x, y);

  // Head
  ctx.fillStyle = "white";
  ctx.beginPath();
  ctx.arc(0, 0, size/2, 0, Math.PI*2);
  ctx.fill();

  // Eyes
  ctx.fillStyle = "black";
  ctx.beginPath();
  ctx.arc(-10, -5, 4, 0, Math.PI*2);
  ctx.arc(10, -5, 4, 0, Math.PI*2);
  ctx.fill();

  // Nose
  ctx.fillStyle = "gold";
  ctx.beginPath();
  ctx.arc(0, 2, 4, 0, Math.PI*2);
  ctx.fill();

  // Whiskers
  ctx.strokeStyle = "black";
  [-1,1].forEach(s=>{
    ctx.beginPath();
    ctx.moveTo(s*8, 4);
    ctx.lineTo(s*20, 0);
    ctx.moveTo(s*8, 8);
    ctx.lineTo(s*20, 8);
    ctx.stroke();
  });

  // Bow
  ctx.fillStyle = "#ff2f92";
  ctx.beginPath();
  ctx.arc(14, -18, 8, 0, Math.PI*2);
  ctx.arc(24, -18, 8, 0, Math.PI*2);
  ctx.fill();

  ctx.restore();
}

/* ================= GAME LOOP ================= */
function spawnHeart() {
  hearts.push({ lane: Math.floor(Math.random()*3), y: -30 });
}

setInterval(() => {
  if (playing && !paused) spawnHeart();
}, 900);

function loop() {
  if (!playing) return;
  requestAnimationFrame(loop);
  if (paused) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ground
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, canvas.height-90, canvas.width, 90);

  // Player physics
  player.vy += gravity;
  player.y += player.vy;
  if (player.y > canvas.height-150) {
    player.y = canvas.height-150;
    player.vy = 0;
    player.jumping = false;
  }

  const px = canvas.width/2 + lanes[currentLane]*canvas.width;
  drawHelloKitty(px, player.y, player.size);

  // Hearts
  hearts.forEach((h,i)=>{
    h.y += speed;
    const hx = canvas.width/2 + lanes[h.lane]*canvas.width;
    ctx.font = "32px serif";
    ctx.fillText("‚ù§Ô∏è", hx-16, h.y);

    if (h.lane === currentLane &&
        h.y > player.y-20 &&
        h.y < player.y+40) {
      hearts.splice(i,1);
      score++;
      document.getElementById("score").textContent = score;
      if (messages[score]) showMessage(messages[score]);
      navigator.vibrate?.(40);
    }
  });

  // Confetti
  confetti.forEach((c,i)=>{
    c.x += c.vx;
    c.y += c.vy;
    ctx.fillStyle = c.color;
    ctx.fillRect(c.x, c.y, 6, 6);
    if (c.y > canvas.height) confetti.splice(i,1);
  });
}

/* ================= MESSAGE POPUP ================= */
function showMessage(text) {
  paused = true;
  spawnConfetti();
  popupSound();
  document.getElementById("msgText").textContent = text;
  document.getElementById("messageBox").style.display = "flex";
}

function resumeGame() {
  paused = false;
  document.getElementById("messageBox").style.display = "none";
}

/* ================= START ================= */
function startGame() {
  document.getElementById("start").style.display = "none";
  initAudio();
  player.y = canvas.height-150;
  playing = true;
  loop();
}

/* ================= TOUCH CONTROLS ================= */
let sx=0, sy=0;
addEventListener("touchstart", e=>{
  sx = e.touches[0].clientX;
  sy = e.touches[0].clientY;
});
addEventListener("touchend", e=>{
  const dx = e.changedTouches[0].clientX - sx;
  const dy = e.changedTouches[0].clientY - sy;

  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx>40 && currentLane<2) currentLane++;
    if (dx<-40 && currentLane>0) currentLane--;
  } else {
    if (dy<-40 && !player.jumping) {
      player.vy = -18;
      player.jumping = true;
    }
    if (dy>40) {
      player.sliding = true;
      setTimeout(()=>player.sliding=false,500);
    }
  }
});
</script>

</body>
</html>
